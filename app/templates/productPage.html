{% extends "base.html" %}

{% block content %}

<br>
<a href="{{ url_for('index.index') }}">Home</a>
<p><a href="{{ url_for('products.products_by_cat', cat_name=summary.cat_name, page=0, amount=10, sort_by='none', direction='none' )}}">Other {{summary.cat_name}} products</a></p>
<br><br><br><br><br><br>
<br>
<div class="contain-top">
<div style="width:30%;height:20%;line-height:3em;overflow:scroll;padding:5px; float: right; border: 3px solid black">
  <h3>Buy this product from current sellers!</h3>
  {% if not(current_user.is_authenticated) %}
  <small class="text-muted">Log in to add products to your cart</small>
  {% endif %}
  {% if summary.total_stock > 0 %}

      {% for seller in sellers %}
        <div>
          {{seller.firstname}} {{seller.lastname}}  
          <small class="text-muted">(Price: {{seller.price}}; Stock: {{seller.stock}})</small>
          
          {% if current_user.is_authenticated %}
          <form action="{{ url_for('cartRouter.add_cart', user_id=current_user.id, seller_id=seller.seller_id, product_id=product.id, quantity = "0") }}" method="POST"> 
            <input type="number" id="quantity" name="quantity" required
                min="1" max="{{seller.stock}}"> 
            <input type="submit" value="Add to Cart">
          </form>
          {% endif %}
        </div>

      {% endfor %}
      {% else %}
      <div>
        No current listings
      </div>
        
      {% endif %}
</div>


  <div style="width: 70%;text-align: center;float:center">
        <img style="text-align: center;" src="{{product.image_file}}">
        <div style="text-align: center;">
          <h2> {{summary.name}} </h2>
        <h2> {{summary.avg_rating}} Stars </h2>
        <p>ID: {{summary.product_id}}</p>
		{% if summary.total_stock > 0 %}
		    <h5 style="font-size: 24px; color:green"> In Stock</h5>
    {%else%}
            <h5 style="font-size: 24px; color:red"> Out of Stock </h5>
    {%endif%}   
		<h5>Category: {{summary.cat_name}}</h5>
		<h5>Average Price: {{summary.avg_price}}</h5>
    <h5>Total Stock: {{summary.total_stock}}</h5>
		<h5>Description: {{summary.description}}</h5>

        </div>
  </div>

</div>
<br><br><br><br><br><br>
		<h5>Reviews: ({{summary.reviews}}) </h5>
        {% if reviews %}
        <div class="card-columns">
        {% for review in reviews %}
            <div class="card" style="max-width: 18rem;">
              <div class="card-body" onclick="window.location.href='{{ url_for('index.review_history', page=0, type='product_history', product_id=product.id)}}'">
                <h5 class="card-title">Rating: {{review.rating}}</h5>
                <p class="card-text">User: {{review.firstname}} {{review.lastname}} </p>
                <p class="card-text">Description: {{review.description}}</p>
                <p class="card-text"><small class="text-muted">{{review.date_time}}</small></p>
              </div>
            </div>
        {% endfor %}
        </div>
        {% endif %}
        {% if page == 0 %}
        <nav aria-label="product pagination">
          <ul class="pagination">
            <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
            <li class="page-item"><a class="page-link" href="{{ url_for('products.productPage', id=product.id, page = page + 1)}}">Next</a></li>
          </ul>
        </nav>
          {% elif stop == True  %}
          <nav aria-label="product pagination">
            <ul class="pagination">
              <li class="page-item"><a class="page-link" href="{{ url_for('products.productPage', id=product.id, page = page - 1)}}">Previous</a></li>
              <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
            </ul>
          </nav>
          {% else %} 
          <nav aria-label="product pagination">
            <ul class="pagination">
              <li class="page-item"><a class="page-link" href="{{ url_for('products.productPage', id=product.id, page = page - 1)}}">Previous</a></li>
              <li class="page-item"><a class="page-link" href="{{ url_for('products.productPage', id=product.id, page = page + 1)}}">Next</a></li>
            </ul>
          </nav>
          {% endif %}
          <small class="text-muted">Page: {{page}}</small>
<br><br><br>
{% endblock %}
